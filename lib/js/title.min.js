'use strict';window.tsfTitle=function(a){const b="undefined"!=typeof tsfTitleL10n&&tsfTitleL10n,c=tsf.escapeString(b.params.untitledTitle),d=tsf.escapeString(b.params.protectedTitle),e=tsf.escapeString(b.params.privateTitle),f=new Map;let g={},h=new Map,i=new Map;const j=a=>h.get(a)||"",k=a=>i.get(a)||"",l=(a,b)=>h.set(a,b)&&j(a),m=(a,b)=>i.set(a,b)&&k(a),n=b=>document.getElementById("tsf-title-placeholder-prefix_"+b)||a("</span>")[0],o=b=>document.getElementById("tsf-title-placeholder-additions_"+b)||a("</span>")[0];let p;const q=()=>{if(p)return p;for(const a of f.keys())if(r(a,"hasLegacy"))return p=a},r=(a,b)=>("useTagline"===b&&(tsf.deprecatedFunc("tsfTitle.getStateFor( id, 'useTagline' )","4.1.0","tsfTitle.getStateFor( id, 'addAdditions' )"),b="addAdditions"),b?b in g[a]?g[a][b]:void 0:g[a]),s=(a,b,c)=>{if(a in g)switch("useTagline"===b&&(tsf.deprecatedFunc("tsfTitle.updateStateFor( id, 'useTagline' )","4.1.0","tsfTitle.updateStateFor( id, 'addAdditions' )"),b="addAdditions"),g[a][b]=c,b){case"prefixValue":case"prefixPlacement":x(a),H(a);break;case"addAdditions":case"separator":case"additionValue":case"additionPlacement":w(a),H(a);break;case"useSocialTagline":case"allowReferenceChange":case"defaultTitle":default:H(a);}},t=a=>{let b=[document.getElementById("tsf-title-reference_"+a)];if(r(a,"hasLegacy")){let a=document.getElementById("tsf-title-reference");a&&b.unshift(a)}return b},u=a=>[document.getElementById("tsf-title-noadditions-reference_"+a)],v=b=>{let c=t(b.target.id),d=u(b.target.id),e=r(b.target.id,"allowReferenceChange"),f=e&&b.target.value||r(b.target.id,"defaultTitle")||"",g="";if(!c[0]||!d[0])return;if(f=f.trim(),g=f,1>f.length||!e)f=b.target.placeholder;else{let a=k(b.target.id),c=j(b.target.id);if(a.length){switch(r(b.target.id,"prefixPlacement")){case"before":tsf.l10n.states.isRTL?f+=a:f=a+f;break;case"after":tsf.l10n.states.isRTL?f=a+f:f+=a;}g=f}if(c.length)switch(r(b.target.id,"additionPlacement")){case"before":f=c+f;break;case"after":f+=c;}}let h=tsf.escapeString(tsf.decodeEntities(tsf.sDoubleSpace(f.trim()))),i=tsf.escapeString(tsf.decodeEntities(tsf.sDoubleSpace(g.trim())));c.forEach(b=>{b.innerHTML=h,setTimeout(()=>{a(b).change()},0)}),d.forEach(b=>{b.innerHTML=i,setTimeout(()=>{a(b).change()},0)})},w=a=>{let b="",c="",d="";if(r(a,"addAdditions")&&(c=r(a,"additionValue"),d=r(a,"separator")),c)switch(r(a,"additionPlacement")){case"before":b=c+" "+d+" ";break;case"after":b=" "+d+" "+c;}o(a).innerHTML=l(a,b||"")},x=a=>{let b="",c=r(a,"prefixValue");if(c)switch(r(a,"prefixPlacement")){case"before":b=tsf.l10n.states.isRTL?" "+c:c+" ";break;case"after":b=tsf.l10n.states.isRTL?c+" ":" "+c;}n(a).innerHTML=m(a,b||"")},y=b=>{var c=Math.round;let d=o(b.target.id),e=n(b.target.id);if(!d&&!e)return;let f=b.target,g=a(f),h=g.val(),i=k(b.target.id),l=j(b.target.id),m=!!i.length,p=!!l.length;if(!m&&e&&(e.style.display="none"),!p&&d&&(d.style.display="none"),!m&&!p)return void g.css("text-indent","initial");if(!h.length)return g.css("text-indent","initial"),e&&(e.style.display="none"),void(d&&(d.style.display="none"));let q=g.outerWidth(!0),s=(g.outerHeight(!0)-g.height())/2,t=parseInt(g.css("marginTop"))/2,u=parseInt(g.css("marginBottom"))/2,v=(q-g.innerWidth())/2,w=tsf.l10n.states.isRTL?"right":"left",x=(g.outerWidth(!0)-g.width())/2,y={display:g.css("display"),lineHeight:g.css("lineHeight"),fontFamily:g.css("fontFamily"),fontWeight:g.css("fontWeight"),fontSize:g.css("fontSize"),letterSpacing:g.css("letterSpacing"),marginTop:t+"px",marginBottom:u+"px",paddingTop:s+"px",paddingBottom:s+"px"},z=a(e),A=a(d),B=0,C=0,D=0,E=0,F=0,G=0;if(m&&(z.css(y),z.css({maxWidth:"initial"}),F=e.getBoundingClientRect().width,F<G&&(F=0)),p){let c=0;switch((()=>{let d=document.getElementById("tsf-title-offset_"+b.target.id),e=a(d);e.text(h),e.css({fontFamily:y.fontFamily,fontWeight:y.fontWeight,letterSpacing:y.letterSpacing,fontSize:y.fontSize}),c=d.getBoundingClientRect().width})(),B=f.getBoundingClientRect().width-v-x-c-F,B<G&&(F+=B,B=0),A.css(y),A.css({maxWidth:"initial"}),r(b.target.id,"additionPlacement")){case"before":let e=d.getBoundingClientRect().width;e=B<e?B:e,e<G&&(e=0),B=e,E+=B,D+=B,C+=x;break;case"after":C+=x+c+F;}}D+=x,F=0>F?0:F,E+=F;let H;m&&(H={},H[w]=D+"px",H.maxWidth=F+"px",z.css(H)),p&&(H={},H[w]=C+"px",H.maxWidth=B+"px",A.css(H)),H={},H["text-indent"]=c(E)+"px",g.css(H)},z=a=>{!r(a.target.id,"allowReferenceChange")||a.target.value||(a.target.placeholder=t(a.target.id)[0].innerText)},A=a=>{if("tsfC"in window){let b=document.getElementById(a.target.id+"_chars"),c=t(a.target.id)[0];b&&tsfC.updateCharacterCounter({e:b,text:c.innerHTML,field:"title",type:"search"})}},B=a=>{if("tsfC"in window){let b=document.getElementById(a.target.id+"_pixels"),c=t(a.target.id)[0];b&&tsfC.updatePixelCounter({e:b,text:c.innerHTML,field:"title",type:"search"})}},C=b=>{b?a(f.get(b)).trigger("input.tsfUpdateTitles"):f.forEach(a=>a.id&&C(a.id))},D=b=>{b?a(f.get(b)).trigger("tsf-update-title-counter"):f.forEach(a=>a.id&&D(a.id))},E=a=>{y(a),v(a),z(a),F(a)},F=a=>{A(a),B(a)};let G=0;const H=()=>{clearTimeout(G),G=setTimeout(C,10)},I=a=>{if("tsfAys"in window){let b=tsfAys.getChangedState;C(a),b||tsfAys.reset()}else C(a)};let J={};const K=a=>{a in J&&clearTimeout(J[a]),J[a]=setTimeout(()=>I(a),10)},L=a=>{let b=document.getElementById(a.target.dataset.for);if(b){let c=a.target.classList.contains("tsf-title-placeholder-additions")?"additions":"prefix",d=b.value;switch(b.focus(),a.detail){case 3:b.setSelectionRange(0,d.length);break;case 2:let e,f;"additions"===c&&"after"===r(b.id,"additionPlacement")||"prefix"===c&&tsf.l10n.states.isRTL?(e=d.replace(/(\w+|\s+)$/u,"").length,f=d.length):(e=0,f=d.length-d.replace(/^(\s+|\w+)/u,"").length),b.setSelectionRange(e,f);break;case 1:default:let g="additions"===c&&"after"===r(b.id,"additionPlacement")?d.length:0;b.setSelectionRange(g,g);}}};let M=window.innerWidth;const N=()=>{let a=window.innerWidth;M<a?782>=M&&782<=a&&I():782<=M&&782>=a&&I(),M=a},O=()=>{document.addEventListener("wp-window-resized",N),window.addEventListener("tsf-counter-updated",H)},P=b=>{!b instanceof Element||(a(b).on("input.tsfUpdateTitles",E),a(b).on("tsf-update-title-counter",F),n(b.id).addEventListener("click",L),o(b.id).addEventListener("click",L),w(b.id),x(b.id),K(b.id))};return Object.assign({load:()=>{document.body.addEventListener("tsf-onload",O)}},{setInputElement:a=>(f.set(a.id,a),g[a.id]={allowReferenceChange:!0,defaultTitle:"",separator:b.states.titleSeparator,prefixPlacement:b.states.prefixPlacement},P(a),f.get(a.id)),getInputElement:a=>f.get(a),getState:a=>(tsf.deprecatedFunc("tsfTitle.getState()","4.1.0","tsfTitle.getStateFor()"),r(q(),a)),getStateFor:r,updateState:(a,b)=>(tsf.deprecatedFunc("tsfTitle.updateState()","4.1.0","tsfTitle.updateStateFor()"),s(q(),a,b)),updateStateFor:s,updateStateAll:(a,b)=>{f.forEach(c=>{s(c.id,a,b)})},triggerCounter:D,triggerInput:C,enqueueTriggerInput:H,triggerUnregisteredInput:I,enqueueUnregisteredInputTrigger:K},{l10n:b,untitledTitle:c,privatePrefix:e,protectedPrefix:d})}(jQuery),jQuery(window.tsfTitle.load);
